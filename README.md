# XueXiTong_HealthCheckBeforeGoToSchool

在"学习通"的"入校前健康登记“操作健康打卡，进入提交记录搜索刚刚的提交记录判断打卡是否成功，然后截屏并发送email到自己手机邮箱.

# 下面分几个部分来介绍本程序

## **1. 这个程序在做什么**

### 1.1. 用电脑网页版代替手机APP学习通的"入校前健康登记"

### 1.2. 登录后添加体温数值，勾选健康、到校等选项，提交结果

### 1.3. 打开提交记录页，搜索当天日期以判断提交成功

### 1.4. 截图提交记录，并连同提交结果一起发送电子邮件到一个或多个手机邮箱

### 1.5. 因自身原因请假等其它情况，要自己在手机中填，本程序只针对正常体温正常作息进行登记

## **2. 功能怎么配置使用**

### 2.1. 将整个项目文件夹放在自己喜欢的位置

### 2.2. 双击setup.bat （windows 操作系统）文件，以配置计划任务。计划任务将每天早上6:30运行一次健康登记任务

### 2.3. 用记事本打卡配置模板personinf.ini

#### 2.3.1 按自己的实际情况修改自己的用户名: username=自己的学习通登录用户名

#### 2.3.2 按自己的实际情况修改自己的密码: password=自己的学习通登录密码

#### 2.3.3 按自己的实际情况修改自己发件人的邮箱地址：senderEmailAddr=自己的发件人邮箱

#### 2.3.4 按自己的实际情况修改自己发件人的邮箱的smtp： senderEmailAddr=自己的发件人邮箱smtp

#### 2.3.5 按自己的实际情况修改自己发件人邮箱授权码（一般终端软件不能用密码登录发送邮件）: authentication=邮箱授权码

#### 2.3.6 按自己的实际情况修改收件人邮箱邮箱地址，每个邮箱一行

        Receiver1='收件邮箱地址1'
        Receiver2='收件邮箱地址2'
        Receiver3='收件邮箱地址3'
        ......
        ReceiverN='收件邮箱地址N'

#### 2.3.7 保存

### 2.4. 安装Google Chrome 浏览器.下载地址： <https://www.google.cn/chrome/>

### 2.5. 添加Google Chrome浏览器对应版本的驱动chromedrive.exe

#### 2.5.1. 下载地址： <https://chromedriver.storage.googleapis.com/index.html>

#### 2.5.2. Windows操作系统的chromedriver.exe文件只有32位的，无论谷歌浏览器是32位还是64位

### 2.6. 谷歌浏览器驱动解压后放置的位置

#### 2.6.1. 一般放在系统环境变量所指的目录

#### 2.6.2. 我放在python安装目录的Script文件夹下： C:\Users\当前登录的用户\AppData\Local\Programs\Python\Python38\Scripts

## **3. 功能实现原理**

### 3.1. 通过批处理脚本添加windows计划任务

#### 3.1.1 运行setup.bat添加windows计划任务HealthCheck

#### 3.1.2 每天就会自动在早上06:30运行RunClockin.bat

#### 3.1.3 批处理脚本RunClockin.bat运行健康登记的python程序

### 3.2. Python脚本读取excel中的异常日期

#### 3.2.1 因节假日调休，周末要上学

#### 3.2.2 因法定节假日，工作日休息

#### 3.2.3 寒暑假放假

#### 3.2.4 注意:日期间不要重叠

#### 3.2.5 不在表格中的正常日期，将在工作日登记，周末不登记

### 3.3. 网页操作

#### 3.3.1. 通过Selenium打卡谷歌浏览器，登录并打开"入校前健康登记"页面

#### 3.3.2. 通过Selenium添加体温值，默认在36.2和36.3之间随机选一个值

#### 3.3.3. 通过Selenium勾选健康及到校选项

#### 3.3.4. 通过Selenium提交登记

#### 3.3.5. 通过Selenium进入提交记录页面，搜索当天日期

##### 3.3.5.1 如果搜索到当天日期：提交成功

##### 3.3.5.2 如果不能搜索到当天日期：提交失败

##### 3.3.5.3 无论提交结果如何，都截图保存

### 3.4 发送邮件

#### 3.4.1 获取提交结果，在邮件内容中会以文字形式描述成功或失败

#### 3.4.2 上传之前保存的截图

#### 3.4.3 发送邮件到指定的接收邮箱

## **4. 故障排除**

### 4.1 批处理setup.bat所添加的计划任务HealthCheck手动可以运行，而定时自动运行总是失败

#### 4.1.1 可能的原因： 批处理脚本RunClockin.bat和python文件clockin.py的用户权限不够

#### 4.1.2 针对4.1.1的解决方法如下

##### 4.1.2.1 右击RunClockin.bat，单击“属性”

##### 4.1.2.2 前往 “安全” => “编辑” => “添加” => “高级” => “立即查找”

##### 4.1.2.3 在下面列表中找到自己当前的用户名， 然后单击“确认” “确认” 再 “确认”，直到所有弹出的窗口全部关闭

### 4.2 未按excel表格中的日期执行

#### 4.2.1 可能原因：电脑太久没有关机,已经出现了不可预见的错误

#### 4.2.2 针对4.2.1的解决方法如下

##### 4.2.2.1 重启电脑后，再登陆用户

#### 4.2.2 可能原因：表格的日期段或某单日有重叠，程序运行到第一个满足条件的，后面的就跳过不执行了

#### 4.2.3 针对4.2.2的解决方法如下

##### 4.2.3.1 重新调整表格中的日期，可以切成多个日期段，尤其是寒暑假的起止日期，中间返校日期，容易出现重叠异常

### 4.3 python程序打开谷歌浏览器异常

#### 4.3.1 可能原因： 谷歌浏览器自动更新了版本，而所使用的谷歌浏览器驱动文件chromedriver 还是针对旧的版本

#### 4.3.2 针对4.3.1的解决方法如下

##### 4.3.2.1 临时对策：去谷歌浏览器驱动网站重新下载更新后匹配版本的chromedriver并更新到自己的电脑。配置chromedriver的方法在2.5 和2.6中有提过

##### 4.3.2.2 长期对策：禁止google浏览器自动更新. 在搜索栏输入services打开应用 => 找到并打开Google更新服务(gupdate) => 启动类型选择“禁用”并点击“确认”

###### 4.3.2.2.1 搜索栏输入services并回车 => 找到并双击google更新服务(gupdate) => 启动类型选择禁用=> 确认
